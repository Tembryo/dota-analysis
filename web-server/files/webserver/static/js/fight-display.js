
  //hero images
var icon_pictures = {
"abaddon":              "/static/img/heroes/pictures/Abaddon.png",
"alchemist":            "/static/img/heroes/pictures/Alchemist.png",
"ancient_apparition":   "/static/img/heroes/pictures/Ancient_Apparition.png",
"antimage":             "/static/img/heroes/pictures/Antimage.png",
"arc_warden":           "/static/img/heroes/pictures/Arc Warden.png",
"axe":                  "/static/img/heroes/pictures/Axe.png",
"bane":                 "/static/img/heroes/pictures/Bane.png",
"batrider":             "/static/img/heroes/pictures/Batrider.png",
"beastmaster":          "/static/img/heroes/pictures/Beastmaster.png",
"bloodseeker":          "/static/img/heroes/pictures/Bloodseeker.png",
"bounty_hunter":        "/static/img/heroes/pictures/Bounty_Hunter.png",
"brewmaster":           "/static/img/heroes/pictures/Brewmaster.png",
"bristleback":          "/static/img/heroes/pictures/Bristleback.png",
"broodmother":          "/static/img/heroes/pictures/Broodmother.png",
"centaur":              "/static/img/heroes/pictures/Centaur_Warrunner.png",
"chaos_knight":         "/static/img/heroes/pictures/Chaos_Knight.png",
"chen":                 "/static/img/heroes/pictures/Chen.png",
"clinkz":               "/static/img/heroes/pictures/Clinkz.png",
"crystal_maiden":       "/static/img/heroes/pictures/Crystal Maiden.png",
"dark_seer":            "/static/img/heroes/pictures/Dark Seer.png",
"dazzle":               "/static/img/heroes/pictures/Dazzle.png",
"death_prophet":        "/static/img/heroes/pictures/Death_Prophet.png",
"disruptor":            "/static/img/heroes/pictures/Disruptor.png",
"doom_bringer":         "/static/img/heroes/pictures/Doom.png",
"dragon_knight":        "/static/img/heroes/pictures/Dragon_Knight.png",
"drow_ranger":          "/static/img/heroes/pictures/Drow_Ranger.png",
"earthshaker":          "/static/img/heroes/pictures/Earthshaker.png",
"elder_titan":          "/static/img/heroes/pictures/Elder_Titan.png",
"earth_spirit":         "/static/img/heroes/pictures/Earth_Spirit.png",
"ember_spirit":         "/static/img/heroes/pictures/Enchantress.png",
"enchantress":          "/static/img/heroes/pictures/Ember_Spirit.png",
"enigma":               "/static/img/heroes/pictures/Enigma.png",
"furion":               "/static/img/heroes/pictures/Furion.png",
"faceless_void":        "/static/img/heroes/pictures/Faceless Void.png",
"gyrocopter":           "/static/img/heroes/pictures/Gyrocopter.png", 
"huskar":               "/static/img/heroes/pictures/Huskar.png",
"invoker":              "/static/img/heroes/pictures/Invoker.png",
"jakiro":               "/static/img/heroes/pictures/Jakiro.png",
"juggernaut":           "/static/img/heroes/pictures/Juggernaut.png",
"keeper_of_the_light":  "/static/img/heroes/pictures/Keeper_of_the_Light.png",
"kunkka":               "/static/img/heroes/pictures/Kunkka.png",
"legion_commander":     "/static/img/heroes/pictures/Legion_Commander.png",
"leshrac":              "/static/img/heroes/pictures/Leshrac.png",
"lich":                 "/static/img/heroes/pictures/Lich.png",
"life_stealer":         "/static/img/heroes/pictures/Life Stealer.png",
"lina":                 "/static/img/heroes/pictures/Lina.png",
"lion":                 "/static/img/heroes/pictures/Lion.png",
"lone_druid":           "/static/img/heroes/pictures/Lone_Druid.png",
"luna":                 "/static/img/heroes/pictures/Luna.png",
"lycan":                "/static/img/heroes/pictures/Lycanthrope.png",
"magnataur":            "/static/img/heroes/pictures/Magnataur.png",
"medusa":               "/static/img/heroes/pictures/Medusa.png",
"meepo":                "/static/img/heroes/pictures/Meepo.png",
"mirana":               "/static/img/heroes/pictures/Mirana.png",
"morphling":            "/static/img/heroes/pictures/Morphling.png",
"naga_siren":           "/static/img/heroes/pictures/Naga Siren.png",
"necrolyte":            "/static/img/heroes/pictures/Necrolyte.png",
"nevermore":            "/static/img/heroes/pictures/Shadow_Fiend.png",
"night_stalker":        "/static/img/heroes/pictures/Night_Stalker.png",
"nyx_assassin":         "/static/img/heroes/pictures/Nyx Assassin.png",
"obsidian_destroyer":   "/static/img/heroes/pictures/Obsidian Destroyer.png",
"ogre_magi":            "/static/img/heroes/pictures/Ogre_Magi.png",
"omniknight":           "/static/img/heroes/pictures/Omniknight.png",
"oracle":               "/static/img/heroes/pictures/Oracle.png",
"phantom_assassin":     "/static/img/heroes/pictures/Phantom_Assassin.png",
"phantom_lancer":       "/static/img/heroes/pictures/Phantom_Lancer.png",
"phoenix":              "/static/img/heroes/pictures/Phoenix.png",
"puck":                 "/static/img/heroes/pictures/Puck.png",
"pudge":                "/static/img/heroes/pictures/Pudge.png",
"pugna":                "/static/img/heroes/pictures/Pugna.png",
"queenofpain":          "/static/img/heroes/pictures/Queen of Pain.png",
"rattletrap":           "/static/img/heroes/pictures/Rattletrap.png",
"razor":                "/static/img/heroes/pictures/Razor.png",
"riki":                 "/static/img/heroes/pictures/Riki.png",
"rubick":               "/static/img/heroes/pictures/Rubick.png",
"sand_king":            "/static/img/heroes/pictures/Sand_King.png",
"shadow_demon":         "/static/img/heroes/pictures/Shadow_Demon.png",
"shadow_shaman":        "/static/img/heroes/pictures/Shadow_Shaman.png",
"shredder":             "/static/img/heroes/pictures/Timbersaw.png",
"silencer":             "/static/img/heroes/pictures/Silencer.png",
"skeleton_king":        "/static/img/heroes/pictures/Wraith_King.png",
"skywrath_mage":        "/static/img/heroes/pictures/Skywrath_Mage.png",
"slardar":              "/static/img/heroes/pictures/Slardar.png",
"slark":                "/static/img/heroes/pictures/Slark.png",
"sniper":               "/static/img/heroes/pictures/Sniper.png",
"spectre":              "/static/img/heroes/pictures/Spectre.png", 
"spirit_breaker":       "/static/img/heroes/pictures/Spirit_Breaker.png",
"storm_spirit":         "/static/img/heroes/pictures/Storm_Spirit.png",
"sven":                 "/static/img/heroes/pictures/Sven.png",
"techies":              "/static/img/heroes/pictures/Techies.png",
"templar_assassin":     "/static/img/heroes/pictures/Templar Assassin.png",
"terrorblade":          "/static/img/heroes/pictures/Terrorblade.png",
"tidehunter":           "/static/img/heroes/pictures/Tidehunter.png",
"tinker":               "/static/img/heroes/pictures/Tinker.png",
"tiny":                 "/static/img/heroes/pictures/Tiny.png",
"treant":               "/static/img/heroes/pictures/Treant.png",
"troll_warlord":        "/static/img/heroes/pictures/Troll_Warlord.png",
"tusk":                 "/static/img/heroes/pictures/Tusk.png",
"undying":              "/static/img/heroes/pictures/Undying.png",
"vengefulspirit":       "/static/img/heroes/pictures/Vengeful Spirit.png",
"venomancer":           "/static/img/heroes/pictures/Venomancer.png",
"viper":                "/static/img/heroes/pictures/Viper.png", 
"visage":               "/static/img/heroes/pictures/Visage.png",
"ursa":                 "/static/img/heroes/pictures/Ursa.png",
"warlock":              "/static/img/heroes/pictures/Warlock.png",
"weaver":               "/static/img/heroes/pictures/Weaver.png",
"windrunner":           "/static/img/heroes/pictures/Windrunner.png",
"winter_wyvern":        "/static/img/heroes/pictures/Winter Wyvern.png",
"wisp":                 "/static/img/heroes/pictures/Wisp.png",
"witch_doctor":         "/static/img/heroes/pictures/Witch_Doctor.png",
"zuus":                 "/static/img/heroes/pictures/Zeus.png"
  };

// open up the header file for the match
// need to decide if will simply load the whole analysis file instead
function displayFights(json) {
    replay_data = json;
    var hero_id = {};
    var hero_namespace = replay_data["header"]["parameters"]["namespace"]["hero_namespace"];
    for (i = 0; i < replay_data["header"]["parameters"]["general"]["num_players"]; i++){
        hero_id[hero_namespace+i] = replay_data["header"]["players"][i]["hero"]; 
    };
    var fights = findFightEvents();
    var num_keys = Object.keys(fights).length;
    // loop over all of the fights in the json file
    for (var i = 0; i < num_keys; i++){
        // make a div to contain each fight
        var fight_div = $("<div> </div>");
        $(fight_div).addClass("fight_div");
        $(fight_div).addClass("carousel_box");
        $(fight_div).attr("id",i);
        var fight_title = "<h2 class = fight_title> Fight " + i + "</h2>"; 
        $(fight_div).append(fight_title);
        // put two divs inside this div to separate the radiant and dire heros
        var fight_div_radiant = $("<div> </div>");
        $(fight_div_radiant).addClass("fight_div_radiant");
        $(fight_div).append(fight_div_radiant);
        var fight_div_dire = $("<div> </div>");
        $(fight_div).append(fight_div_dire);
        //find the number of heros invovled in the fight
        var event_id = Object.keys(fights[i]);
        var involved = fights[i][event_id[0]]["involved"];
        var killed = fights[i][event_id[0]]["killed"];
        // make a div to contain the picture of each hero involved in the fight
        for (var j = 0; j < involved.length; j++){
            var hero_pic_div= $("<div> </div>");
            $(hero_pic_div).addClass("hero_pic_div");
            var hero_image_location = icon_pictures[hero_id[involved[j]]];
            var hero_img = $("<img src = '" + hero_image_location + "'>");
            $(hero_img).addClass("hero_img");
            $(hero_pic_div).append(hero_img);
            //check if that hero was killed in the fight
            for (var k = 0; k < killed.length; k++){
                if (involved[j] == killed[k]) {
                    var skull_img = $("<img src = '/static/img/elements/Red_Cross.svg' >");
                    $(skull_img).addClass('red_cross_img');
                    $(hero_pic_div).append(skull_img);
                };                  
            }
            // put the images in different divs depending on if they are dire or radiant heros
            if (involved[j] <= 104){
                $(fight_div_radiant).append(hero_pic_div);
            }
            else {
                $(fight_div_dire).append(hero_pic_div);
            }
        };
        // make a div to contain information on the time of the fight/gold/xp exchanged
        var info_div = $("<div> </div>");
        var location = fights[i][event_id[0]]["location"];
        var time_start = Math.floor();
        var time_start_minutes = Math.floor(time_start / 60);
        var time_start_seconds = Math.floor(time_start % 60);

        var time_end = fights[i][event_id[0]]["time-end"];
        var time_end_minutes = Math.floor(time_end / 60);
        var time_end_seconds = Math.floor(time_end % 60);

        var total_damage = fights[i][event_id[0]]["total_damage"];

        var time_text = "<p class = 'fight_text' > Time: " + formatTime(fights[i][event_id[0]]["time-start"]) + " to " + formatTime(fights[i][event_id[0]]["time-end"]) + ", Total Damage: " + total_damage +" </p>";
        var location_text = "<p class = 'fight_text'> Location: " + location + "</p>";
        $(info_div).append(time_text);
        $(info_div).append(location_text);
        $(fight_div).append(info_div);
        // append the div to the fight-list-container
        $("#carousel").append(fight_div);
    };
    var $carousel = $('#carousel').carousel({
        vertical: true,
        indicator:true,
        group: 3
    });           
    $('#carousel_prev').on('click', function(ev) {
        $carousel.carousel('prev');
    });
    $('#carousel_next').on('click', function(ev) {
        $carousel.carousel('next');
    });
    // display the first fight details in the fight-details view when the page laods up
    $("#my_text_area").val('');
    var event_id = Object.keys(fights[0]);
    var attacks = fights[0][event_id[0]]["attack_sequence"];
    var attack_text = "";
    for (i = 0; i < attacks.length; i++){
        var attacker = hero_id[attacks[i]["attacker"]];
        attacker = capitalizeFirstLetter(attacker);
        var victim = hero_id[attacks[i]["victim"]];
        victim = capitalizeFirstLetter(victim);
        var attack_method = attacks[i]["attack_method"];
        var damage = attacks[i]["damage"];
        var health_delta = attacks[i]["health_delta"];
        attack_text = attack_text + "\n " + "At " + formatTime(attacks[i]["t"]) + " - " + attacker + " attacked " + victim + " with " + attack_method + " did " + damage + " damage" + health_delta;
    };
    document.getElementById("my_text_area").value += attack_text;
    // when a new fight is clicked remove the old one and show the new details instead
    $('.fight_div').click(function(){
        $("#my_text_area").val('');
        var selected_id = $(this).attr("id");
        //load attack data into a variable
        var event_id = Object.keys(fights[selected_id]);
        var attacks = fights[selected_id][event_id[0]]["attack_sequence"];

        var attack_text = "";
        for (i = 0; i < attacks.length; i++){       
            var attacker = hero_id[attacks[i]["attacker"]];
            attacker = capitalizeFirstLetter(attacker);
            var victim = hero_id[attacks[i]["victim"]];
            victim = capitalizeFirstLetter(victim);
            var attack_method = attacks[i]["attack_method"];
            var damage = attacks[i]["damage"];
            var health_delta = attacks[i]["health_delta"];
            attack_text = attack_text + "\n " + "At " + formatTime(attacks[i]["t"]) + " - " + attacker + " attacked " + victim + " with " + attack_method + " did " + damage + " damage" + health_delta;

            
        };
        document.getElementById("my_text_area").value += attack_text;

        gui_state["cursor-time"] = fights[selected_id][event_id[0]]["time-start"];
        updateVisualisation();
    });
}   

function str_pad_left(string,pad,length){ 
    return (new Array(length+1).join(pad)+string).slice(-length); 
}


function findFightEvents(){
    //sort events
    fights = [];
    for (var event_id in replay_data["events"]) {
        if (replay_data["events"][event_id]["type"] === "fight")
        {
            fight_element = {event_id:replay_data["events"][event_id]};
            fights.push(fight_element);
        }
    }
    return fights
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
