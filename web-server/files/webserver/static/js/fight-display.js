
  //hero images
var icon_pictures = {
"abaddon":              "/static/img/hero-pictures/Abaddon.png",
"alchemist":            "/static/img/hero-pictures/Alchemist.png",
"ancient_apparition":   "/static/img/hero-pictures/Ancient_Apparition.png",
"antimage":             "/static/img/hero-pictures/Antimage.png",
"arc_warden":           "/static/img/hero-pictures/Arc Warden.png",
"axe":                  "/static/img/hero-pictures/Axe.png",
"bane":                 "/static/img/hero-pictures/Bane.png",
"batrider":             "/static/img/hero-pictures/Batrider.png",
"beastmaster":          "/static/img/hero-pictures/Beastmaster.png",
"bloodseeker":          "/static/img/hero-pictures/Bloodseeker.png",
"bounty_hunter":        "/static/img/hero-pictures/Bounty_Hunter.png",
"brewmaster":           "/static/img/hero-pictures/Brewmaster.png",
"bristleback":          "/static/img/hero-pictures/Bristleback.png",
"broodmother":          "/static/img/hero-pictures/Broodmother.png",
"centaur":              "/static/img/hero-pictures/Centaur_Warrunner.png",
"chaos_knight":         "/static/img/hero-pictures/Chaos_Knight.png",
"chen":                 "/static/img/hero-pictures/Chen.png",
"clinkz":               "/static/img/hero-pictures/Clinkz.png",
"crystal_maiden":       "/static/img/hero-pictures/Crystal Maiden.png",
"dark_seer":            "/static/img/hero-pictures/Dark Seer.png",
"dazzle":               "/static/img/hero-pictures/Dazzle.png",
"death_prophet":        "/static/img/hero-pictures/Death_Prophet.png",
"disruptor":            "/static/img/hero-pictures/Disruptor.png",
"doom_bringer":         "/static/img/hero-pictures/Doom.png",
"dragon_knight":        "/static/img/hero-pictures/Dragon_Knight.png",
"drow_ranger":          "/static/img/hero-pictures/Drow_Ranger.png",
"earthshaker":          "/static/img/hero-pictures/Earthshaker.png",
"elder_titan":          "/static/img/hero-pictures/Elder_Titan.png",
"earth_spirit":          "/static/img/hero-pictures/Earth_Spirit.png",
"ember_spirit":         "/static/img/hero-pictures/Enchantress.png",
"enchantress":          "/static/img/hero-pictures/Ember_Spirit.png",
"enigma":               "/static/img/hero-pictures/Enigma.png",
"furion":               "/static/img/hero-pictures/Furion.png",
"faceless_void":        "/static/img/hero-pictures/Faceless Void.png",
"gyrocopter":           "/static/img/hero-pictures/Gyrocopter.png", 
"huskar":               "/static/img/hero-pictures/Huskar.png",
"invoker":              "/static/img/hero-pictures/Invoker.png",
"jakiro":               "/static/img/hero-pictures/Jakiro.png",
"juggernaut":           "/static/img/hero-pictures/Juggernaut.png",
"keeper_of_the_light":  "/static/img/hero-pictures/Keeper_of_the_Light.png",
"kunkka":               "/static/img/hero-pictures/Kunkka.png",
"legion_commander":     "/static/img/hero-pictures/Legion_Commander.png",
"leshrac":              "/static/img/hero-pictures/Leshrac.png",
"lich":                 "/static/img/hero-pictures/Lich.png",
"life_stealer":         "/static/img/hero-pictures/Life Stealer.png",
"lina":                 "/static/img/hero-pictures/Lina.png",
"lion":                 "/static/img/hero-pictures/Lion.png",
"lone_druid":           "/static/img/hero-pictures/Lone_Druid.png",
"luna":                 "/static/img/hero-pictures/Luna.png",
"lycan":                "/static/img/hero-pictures/Lycanthrope.png",
"magnataur":            "/static/img/hero-pictures/Magnataur.png",
"medusa":               "/static/img/hero-pictures/Medusa.png",
"meepo":                "/static/img/hero-pictures/Meepo.png",
"mirana":               "/static/img/hero-pictures/Mirana.png",
"morphling":            "/static/img/hero-pictures/Morphling.png",
"naga_siren":           "/static/img/hero-pictures/Naga Siren.png",
"necrolyte":            "/static/img/hero-pictures/Necrolyte.png",
"nevermore":            "/static/img/hero-pictures/Shadow_Fiend.png",
"night_stalker":        "/static/img/hero-pictures/Night_Stalker.png",
"nyx_assassin":         "/static/img/hero-pictures/Nyx Assassin.png",
"obsidian_destroyer":   "/static/img/hero-pictures/Obsidian Destroyer.png",
"ogre_magi":            "/static/img/hero-pictures/Ogre_Magi.png",
"omniknight":           "/static/img/hero-pictures/Omniknight.png",
"oracle":               "/static/img/hero-pictures/Oracle.png",
"phantom_assassin":     "/static/img/hero-pictures/Phantom_Assassin.png",
"phantom_lancer":       "/static/img/hero-pictures/Phantom_Lancer.png",
"phoenix":              "/static/img/hero-pictures/Phoenix.png",
"puck":                 "/static/img/hero-pictures/Puck.png",
"pudge":                "/static/img/hero-pictures/Pudge.png",
"pugna":                "/static/img/hero-pictures/Pugna.png",
"queenofpain":          "/static/img/hero-pictures/Queen of Pain.png",
"rattletrap":           "/static/img/hero-pictures/Rattletrap.png",
"razor":                "/static/img/hero-pictures/Razor.png",
"riki":                 "/static/img/hero-pictures/Riki.png",
"rubick":               "/static/img/hero-pictures/Rubick.png",
"sand_king":            "/static/img/hero-pictures/Sand_King.png",
"shadow_demon":         "/static/img/hero-pictures/Shadow_Demon.png",
"shadow_shaman":        "/static/img/hero-pictures/Shadow_Shaman.png",
"shredder":             "/static/img/hero-pictures/Timbersaw.png",
"silencer":             "/static/img/hero-pictures/Silencer.png",
"skeleton_king":        "/static/img/hero-pictures/Wraith_King.png",
"skywrath_mage":        "/static/img/hero-pictures/Skywrath_Mage.png",
"slardar":              "/static/img/hero-pictures/Slardar.png",
"slark":                "/static/img/hero-pictures/Slark.png",
"sniper":               "/static/img/hero-pictures/Sniper.png",
"spectre":              "/static/img/hero-pictures/Spectre.png", 
"spirit_breaker":       "/static/img/hero-pictures/Spirit_Breaker.png",
"storm_spirit":         "/static/img/hero-pictures/Storm_Spirit.png",
"sven":                 "/static/img/hero-pictures/Sven.png",
"techies":              "/static/img/hero-pictures/Techies.png",
"templar_assassin":     "/static/img/hero-pictures/Templar Assassin.png",
"terrorblade":          "/static/img/hero-pictures/Terrorblade.png",
"tidehunter":           "/static/img/hero-pictures/Tidehunter.png",
"tinker":               "/static/img/hero-pictures/Tinker.png",
"tiny":                 "/static/img/hero-pictures/Tiny.png",
"treant":               "/static/img/hero-pictures/Treant.png",
"troll_warlord":        "/static/img/hero-pictures/Troll_Warlord.png",
"tusk":                 "/static/img/hero-pictures/Tusk.png",
"undying":              "/static/img/hero-pictures/Undying.png",
"vengefulspirit":       "/static/img/hero-pictures/Vengeful Spirit.png",
"venomancer":           "/static/img/hero-pictures/Venomancer.png",
"viper":                "/static/img/hero-pictures/Viper.png", 
"visage":               "/static/img/hero-pictures/Visage.png",
"ursa":                 "/static/img/hero-pictures/Ursa.png",
"warlock":              "/static/img/hero-pictures/Warlock.png",
"weaver":               "/static/img/hero-pictures/Weaver.png",
"windrunner":           "/static/img/hero-pictures/Windrunner.png",
"winter_wyvern":        "/static/img/hero-pictures/Winter Wyvern.png",
"wisp":                 "/static/img/hero-pictures/Wisp.png",
"witch_doctor":         "/static/img/hero-pictures/Witch_Doctor.png",
"zuus":                 "/static/img/hero-pictures/Zeus.png"
  };

// open up the header file for the match
// need to decide if will simply load the whole analysis file instead
function displayFights(json) {
	replay_data = json;
	var hero_id = {};
	var hero_namespace = replay_data["header"]["parameters"]["namespace"]["hero_namespace"];
	for (i = 0; i < replay_data["header"]["parameters"]["general"]["num_players"]; i++){
		hero_id[hero_namespace+i] = replay_data["header"]["players"][i]["hero"]; 
	};
	var fights = findFightEvents();
	var num_keys = Object.keys(fights).length;
	// loop over all of the fights in the json file
	for (var i = 0; i < num_keys; i++){
		// make a div to contain each fight
		var fight_div = $("<div> </div>");
		$(fight_div).addClass("fight_div");
		$(fight_div).addClass("carousel_box");
		$(fight_div).attr("id",i);
		var fight_title = "<h2 class = fight_title> Fight " + i + "</h2>"; 
		$(fight_div).append(fight_title);
		// put two divs inside this div to separate the radiant and dire heros
		var fight_div_radiant = $("<div> </div>");
		$(fight_div_radiant).addClass("fight_div_radiant");
		$(fight_div).append(fight_div_radiant);
		var fight_div_dire = $("<div> </div>");
		$(fight_div).append(fight_div_dire);
		//find the number of heros invovled in the fight
		var event_id = Object.keys(fights[i]);
		var involved = fights[i][event_id[0]]["involved"];
		var killed = fights[i][event_id[0]]["killed"];
		// make a div to contain the picture of each hero involved in the fight
		for (var j = 0; j < involved.length; j++){
			var hero_pic_div= $("<div> </div>");
			$(hero_pic_div).addClass("hero_pic_div");
			var hero_image_location = icon_pictures[hero_id[involved[j]]];
			var hero_img = $("<img src = '" + hero_image_location + "'>");
			$(hero_img).addClass("hero_img");
			$(hero_pic_div).append(hero_img);
			//check if that hero was killed in the fight
			for (var k = 0; k < killed.length; k++){
				if (involved[j] == killed[k]) {
					var skull_img = $("<img src = '/static/img/elements/Red_Cross.svg' >");
					$(skull_img).addClass('red_cross_img');
					$(hero_pic_div).append(skull_img);
				};					
			}
			// put the images in different divs depending on if they are dire or radiant heros
			if (involved[j] <= 104){
				$(fight_div_radiant).append(hero_pic_div);
			}
			else {
				$(fight_div_dire).append(hero_pic_div);
			}
		};
		// make a div to contain information on the time of the fight/gold/xp exchanged
		var info_div = $("<div> </div>");
		var location = fights[i][event_id[0]]["location"];
		var time_start = Math.floor();
		var time_start_minutes = Math.floor(time_start / 60);
		var time_start_seconds = Math.floor(time_start % 60);

		var time_end = fights[i][event_id[0]]["time-end"];
		var time_end_minutes = Math.floor(time_end / 60);
		var time_end_seconds = Math.floor(time_end % 60);

		var total_damage = fights[i][event_id[0]]["total_damage"];

		var time_text = "<p class = 'fight_text' > Time: " + formatTime(fights[i][event_id[0]]["time-start"]) + " to " + formatTime(fights[i][event_id[0]]["time-end"]) + ", Total Damage: " + total_damage +" </p>";
		var location_text = "<p class = 'fight_text'> Location: " + location + "</p>";
		$(info_div).append(time_text);
		$(info_div).append(location_text);
		$(fight_div).append(info_div);
		// append the div to the fight-list-container
		$("#carousel").append(fight_div);
  	};
  	var $carousel = $('#carousel').carousel({
		vertical: true,
		indicator:true,
		group: 3
	});			  
	$('#carousel_prev').on('click', function(ev) {
  		$carousel.carousel('prev');
	});
	$('#carousel_next').on('click', function(ev) {
  		$carousel.carousel('next');
	});
	// display the first fight details in the fight-details view when the page laods up
	$("#my_text_area").val('');
	var event_id = Object.keys(fights[0]);
	var attacks = fights[0][event_id[0]]["attack_sequence"];
	var attack_text = "";
	for (i = 0; i < attacks.length; i++){
		var attacker = hero_id[attacks[i]["attacker"]];
		attacker = capitalizeFirstLetter(attacker);
		var victim = hero_id[attacks[i]["victim"]];
		victim = capitalizeFirstLetter(victim);
		var attack_method = attacks[i]["attack_method"];
		var damage = attacks[i]["damage"];
		var health_delta = attacks[i]["health_delta"];
		attack_text = attack_text + "\n " + "At " + formatTime(attacks[i]["t"]) + " - " + attacker + " attacked " + victim + " with " + attack_method + " did " + damage + " damage" + health_delta;
	};
	document.getElementById("my_text_area").value += attack_text;
	// when a new fight is clicked remove the old one and show the new details instead
	$('.fight_div').click(function(){
		$("#my_text_area").val('');
		var selected_id = $(this).attr("id");
		//load attack data into a variable
		var event_id = Object.keys(fights[selected_id]);
		var attacks = fights[selected_id][event_id[0]]["attack_sequence"];

		var attack_text = "";
		for (i = 0; i < attacks.length; i++){		
			var attacker = hero_id[attacks[i]["attacker"]];
			attacker = capitalizeFirstLetter(attacker);
			var victim = hero_id[attacks[i]["victim"]];
			victim = capitalizeFirstLetter(victim);
			var attack_method = attacks[i]["attack_method"];
			var damage = attacks[i]["damage"];
			var health_delta = attacks[i]["health_delta"];
			attack_text = attack_text + "\n " + "At " + formatTime(attacks[i]["t"]) + " - " + attacker + " attacked " + victim + " with " + attack_method + " did " + damage + " damage" + health_delta;

            
		};
		document.getElementById("my_text_area").value += attack_text;

        gui_state["cursor-time"] = fights[selected_id][event_id[0]]["time-start"];
        updateVisualisation();
	});
}	

function str_pad_left(string,pad,length){ 
	return (new Array(length+1).join(pad)+string).slice(-length); 
}


function findFightEvents(){
	//sort events
	fights = [];
	for (var event_id in replay_data["events"]) {
		if (replay_data["events"][event_id]["type"] === "fight")
		{
			fight_element = {event_id:replay_data["events"][event_id]};
			fights.push(fight_element);
		}
	}
	return fights
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
